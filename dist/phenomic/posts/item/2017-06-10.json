{"date":"2017-01-01","title":"Learn with LaForest Notes","desc":"Notes from my development of my classroom website. Includes service worker, CORS, and firebase gotchas.","tags":"firebase, service-worker","author":"Scott LaForest","posted":"06/10/17","body":{"c":[{"c":[{"c":"#","p":{"href":"#learn-with-laforest","className":"phenomic-HeadingAnchor"},"t":"a"},"Learn with LaForest"],"p":{"id":"learn-with-laforest"},"t":"h1"},"\n",{"c":["This repository is my first attempt at a progressive web app. This app is my classroom website (I currently teach high school math and engineering). The app is hosted on firebase, ",{"c":"Learn with LaForest","p":{"href":"https://learn-with-laforest.firebaseapp.com/"},"t":"a"},", for the ease of deployment and data storage as well as PWA requirements of HTTP/2 and HTTPS default on firebase."],"t":"p"},"\n",{"c":[{"c":"#","p":{"href":"#trials-and-triumphs","className":"phenomic-HeadingAnchor"},"t":"a"},"Trials and Triumphs"],"p":{"id":"trials-and-triumphs"},"t":"h1"},"\n",{"c":["\n",{"c":["Implementing switching between classes via the menu button was my first challenge as I had a hard time getting the ",{"c":"addEventListener()","t":"code"}," method to work correctly and pass the ",{"c":"this","t":"code"}," value as well as a parameter. After researching more on the ",{"c":"bind()","t":"code"}," method I realized that I can add args after the ",{"c":"this","t":"code"}," parameter which will be prepended to the bound method. So for each menu item I passed the corresponding class name after the ",{"c":"this","t":"code"}," parameter.  Example"],"t":"li"},"\n"],"t":"ul"},"\n",{"c":{"c":" this.showAlg1 = document.getElementById('showAlg1')\n this.showAlg1.addEventListener('click', this.clickedOn.bind(this, \"Alg1\"));\n","p":{"className":"language-javascript"},"t":"code"},"t":"pre"},"\n",{"c":["\n",{"c":["Service-worker: CDNs at getmdl.io are not CORS supported. So I had to manually fetch them and then cache them thanks to the answer here by Jeff Posnick on ",{"c":"StackOverflow","p":{"href":"https://stackoverflow.com/questions/39109789/what-limitations-apply-to-opaque-responses/39109790#39109790"},"t":"a"},".\nExample"],"t":"li"},"\n"],"t":"ul"},"\n",{"c":{"c":"const request = new Request('https://code.getmdl.io/1.3.0/material.deep_purple-yellow.min.css', {mode: 'no-cors'});\nfetch(request).then(response => cache.put(request, response));\n","p":{"className":"language-javascript"},"t":"code"},"t":"pre"},"\n",{"c":["\n",{"c":["\n",{"c":["Firebase DB- TIL that firebase saves data locally on all firebase clients ",{"c":"Firebase offline","p":{"href":"https://firebase.google.com/docs/database/web/read-and-write#write_data_offline"},"t":"a"}," . I was going to make a fetch then cache fetch event for the firebase databas url but this default functionality seems to work fine for offline."],"t":"p"},"\n"],"t":"li"},"\n",{"c":["\n",{"c":"Struggling getting firebase messagine working with topics. First was using API key instead of SERVER_KEY which led to 401 responses. And also needed to prepend key= in the request header for the google iid api. Still receiving empty object for response on checking current topics.","t":"p"},"\n"],"t":"li"},"\n",{"c":["\n",{"c":["In order to show admin link only to admin (me) I created a child in the firebase db of ",{"c":"isAdmin","t":"code"},". The isAdmin child has children nodes for eadh admin id. I can then check the signed in user's id against the database."],"t":"p"},"\n",{"c":{"c":"this.database.ref('/isAdmin/').once('value').then(function(snapshot) {\n  snapshot.forEach(function(childSnapshot) {\n        if (childSnapshot.key.replace(/\\\"/g, \"\") === userId) {\n          console.log(\"isAdmin\");\n          document.getElementById('showAdmin').removeAttribute(\"hidden\");\n        }\n        else{\n          document.getElementById('showAdmin').setAttribute('hidden', 'true');\n        }\n    });\n});\n","p":{"className":"language-javascript"},"t":"code"},"t":"pre"},"\n"],"t":"li"},"\n"],"t":"ul"}],"t":"div"}}